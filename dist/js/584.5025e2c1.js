"use strict";(self["webpackChunkfrontend_ebox_platform"]=self["webpackChunkfrontend_ebox_platform"]||[]).push([[584],{9980:function(e,t,a){a.d(t,{$x:function(){return l},F7:function(){return u},Qt:function(){return i},ZL:function(){return n},ZZ:function(){return s}});var o=a(1189);const r={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_BASE_URL;function n(e){return o.A.get(`${r}/areas`,{headers:{Authorization:`Bearer ${e}`}})}function l(e,t){return o.A.delete(`${r}/areas/${t}`,{headers:{Authorization:`Bearer ${e}`}})}function i(e,t){return o.A.post(`${r}/areas`,t,{headers:{Authorization:`Bearer ${e}`}})}function s(e,t,a){return o.A.patch(`${r}/areas/${a}`,t,{headers:{Authorization:`Bearer ${e}`}})}function u(e,t,a){return o.A.patch(`${r}/areas/${a}`,t,{headers:{Authorization:`Bearer ${e}`}})}},9509:function(e,t,a){a.d(t,{IO:function(){return u},a$:function(){return s},bN:function(){return n},hO:function(){return i},uq:function(){return l}});var o=a(1189);const r={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_BASE_URL;function n(e){return o.A.get(`${r}/layouts`,{headers:{Authorization:`Bearer ${e}`}})}function l(e,t){return o.A.delete(`${r}/layouts/${t}`,{headers:{Authorization:`Bearer ${e}`}})}function i(e,t){return o.A.post(`${r}/layouts`,t,{headers:{Authorization:`Bearer ${e}`}})}function s(e,t,a){return o.A.patch(`${r}/layouts/${a}`,t,{headers:{Authorization:`Bearer ${e}`}})}function u(e,t,a){return o.A.post(`${r}/layouts/updatebackgroundImage/${a}`,t,{headers:{Authorization:`Bearer ${e}`}})}},8578:function(e,t,a){a.r(t),a.d(t,{default:function(){return B}});var o=a(6768),r=a(4232),n=a(1161);const l={class:"flex justify-center items-center h-screen h-full relative"},i={class:"flex items-center justify-center bg-gray-100 mb-5 pb-5"},s={class:"fixed top-1/2 right-5 transform -translate-y-1/2 flex flex-col items-center space-y-4"},u=["onClick"];function c(e,t,a,c,d,g){const p=(0,o.g2)("ModalLayoutPlane"),f=(0,o.g2)("UploadPlanModal");return(0,o.uX)(),(0,o.CE)("div",l,[(0,o.Lk)("div",i,[c.selectedLayout?((0,o.uX)(),(0,o.Wv)(p,{key:c.selectedLayout._id,name:c.selectedLayout.name,backgroundimage:c.selectedLayout.backgroundImage,areas:c.selectedLayout.areas,onUploadPlans:c.openUploadModal,onAreaSelected:c.selectCoordinates},null,8,["name","backgroundimage","areas","onUploadPlans","onAreaSelected"])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",s,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(c.layouts,((e,t)=>((0,o.uX)(),(0,o.Wv)(n.y,{key:e._id,text:e.name},{activator:(0,o.k6)((({props:e})=>[(0,o.Lk)("div",(0,o.v6)({ref_for:!0},e,{class:["w-10 h-10 rounded-full cursor-pointer flex items-center justify-center transition-transform duration-300",{"bg-[#6999c2] text-white transform scale-110 shadow-lg":t===c.selectedIndex,"bg-[#bfd3e6] text-gray-700 hover:bg-[#6999c2]":t!==c.selectedIndex}],onClick:e=>c.selectLayout(t)}),(0,r.v_)(t+1),17,u)])),_:2},1032,["text"])))),128))]),c.showUploadModal?((0,o.uX)(),(0,o.Wv)(f,{key:0,layoutId:c.selectedLayout._id,onClose:t[0]||(t[0]=e=>c.showUploadModal=!1),onImageUploaded:c.handleImageUpload},null,8,["layoutId","onImageUploaded"])):(0,o.Q3)("",!0)])}var d=a(144),g=a(9509),p=a(9980),f=a(5130);const v={class:"relative flex flex-col items-center"},m={class:"text-gray-700 font-bold text-lg mb-2 relative w-full"},h={class:"relative border border-gray-300 rounded-lg shadow-md"},y={key:0,class:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center"},b={class:"bg-white p-4 rounded shadow-lg w-96"},x=["value"],k={class:"mt-4 flex justify-end"};function A(e,t,a,n,l,i){const s=(0,o.g2)("v-image"),u=(0,o.g2)("v-shape"),c=(0,o.g2)("v-text"),d=(0,o.g2)("v-line"),g=(0,o.g2)("v-layer"),p=(0,o.g2)("v-stage");return(0,o.uX)(),(0,o.CE)("div",v,[(0,o.Lk)("h1",m,[(0,o.eW)((0,r.v_)(a.name)+" ",1),(0,o.Lk)("i",{class:"mdi mdi-image-edit text-3xl cursor-pointer absolute top-0 right-16 text-gray-700 hover:text-[#497fae]",onClick:t[0]||(t[0]=(...e)=>n.openUploadPlans&&n.openUploadPlans(...e))}),(0,o.Lk)("i",{class:(0,r.C4)(["mdi text-3xl cursor-pointer absolute top-0 right-4",n.drawMode?"mdi-pencil-box-outline text-[#099cb4]":"mdi-pencil-box-outline text-gray-700 hover:text-#497fae-500"]),onClick:t[1]||(t[1]=(...e)=>n.toggleDrawMode&&n.toggleDrawMode(...e))},null,2),n.drawMode&&n.currentArea.length>0?((0,o.uX)(),(0,o.CE)("i",{key:0,class:"mdi mdi-close-circle-outline text-3xl cursor-pointer absolute top-0 right-28 text-gray-700 hover:text-red-500",onClick:t[2]||(t[2]=(...e)=>n.cancelDraw&&n.cancelDraw(...e))})):(0,o.Q3)("",!0)]),(0,o.Lk)("div",h,[(0,o.bF)(p,{ref:"stage",config:n.stageConfig},{default:(0,o.k6)((()=>[(0,o.bF)(g,null,{default:(0,o.k6)((()=>[a.backgroundimage?((0,o.uX)(),(0,o.Wv)(s,{key:0,config:{image:n.backgroundImg,width:n.stageConfig.width,height:n.stageConfig.height}},null,8,["config"])):(0,o.Q3)("",!0),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.areas,(e=>((0,o.uX)(),(0,o.CE)(o.FK,{key:e._id},[(0,o.bF)(u,{config:{sceneFunc:(t,a)=>{const o=n.parseCoordinates(e.coordinates);if(t.beginPath(),o.length>0){t.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e++)t.lineTo(o[e].x,o[e].y);t.closePath()}t.fillStrokeShape(a)},fill:"rgba(191, 211, 230, 0.3)",stroke:"#396895",strokeWidth:2}},null,8,["config"]),(0,o.bF)(c,{config:{text:e.name,x:n.calculateAreaCenter(n.parseCoordinates(e.coordinates)).x,y:n.calculateAreaCenter(n.parseCoordinates(e.coordinates)).y,fontSize:16,fontFamily:"Arial",fill:"black",align:"center",verticalAlign:"middle"}},null,8,["config"])],64)))),128)),n.currentArea.length>0&&n.drawMode?((0,o.uX)(),(0,o.Wv)(d,{key:1,config:{points:[...n.currentArea,n.mousePosition.x,n.mousePosition.y],stroke:"#497fae",strokeWidth:2,dash:[5,5],closed:!1}},null,8,["config"])):(0,o.Q3)("",!0)])),_:1})])),_:1},8,["config"]),a.backgroundimage?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("button",{key:0,onClick:t[3]||(t[3]=(...e)=>n.openUploadPlans&&n.openUploadPlans(...e)),class:"text-white bg-[#6999c2] hover:bg-[#28415c] focus:ring-4 focus:outline-none focus:ring-#497fae-300 font-medium rounded-lg text-base px-15 py-6 absolute inset-1/2 transform -translate-x-1/2 -translate-y-1/4 flex items-center justify-center",style:{"writing-mode":"horizontal-tb","text-orientation":"mixed"}}," Cargar plano "))]),n.showModal?((0,o.uX)(),(0,o.CE)("div",y,[(0,o.Lk)("div",b,[t[7]||(t[7]=(0,o.Lk)("h2",{class:"text-lg font-bold mb-4"},"Asignar Área",-1)),t[8]||(t[8]=(0,o.Lk)("label",{for:"area-select",class:"block text-sm font-medium text-gray-700"},"Selecciona el área:",-1)),(0,o.bo)((0,o.Lk)("select",{id:"area-select","onUpdate:modelValue":t[4]||(t[4]=e=>n.selectedAreaId=e),class:"mt-2 block w-full p-2 border border-gray-300 rounded-md"},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.areas,(e=>((0,o.uX)(),(0,o.CE)("option",{key:e._id,value:e._id},(0,r.v_)(e.name),9,x)))),128))],512),[[f.u1,n.selectedAreaId]]),(0,o.Lk)("div",k,[(0,o.Lk)("button",{class:"px-4 py-2 bg-[#396895] text-white rounded hover:bg-[#396895] mr-2",onClick:t[5]||(t[5]=(...e)=>n.confirmAreaSelection&&n.confirmAreaSelection(...e))}," Confirmar "),(0,o.Lk)("button",{class:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",onClick:t[6]||(t[6]=(...e)=>n.closeModal&&n.closeModal(...e))}," Cancelar ")])])])):(0,o.Q3)("",!0)])}a(8992),a(4520),a(1454),a(8872);var w={props:{name:{type:String,required:!0},backgroundimage:{type:String,required:!0},areas:{type:Array,required:!0}},emits:["uploadPlans","areaSelected"],setup(e,{emit:t}){const a={width:1300,height:570},r=(0,d.KR)(null),n=(0,d.KR)(null),l=(0,d.KR)(!1),i=(0,d.KR)(!1),s=(0,d.KR)(null),u=(0,d.KR)([]),c=(0,d.KR)(""),g=(0,d.KR)({x:0,y:0}),p=()=>{u.value=[]},f=()=>{const e=r.value.getNode(),t=e.getPointerPosition();g.value=t||{x:0,y:0}},v=e=>{const t=e.length,a=e.reduce(((e,t)=>(e.x+=t.x,e.y+=t.y,e)),{x:0,y:0});return{x:a.x/t,y:a.y/t}},m=e=>e.split(")").map((e=>e.trim())).filter((e=>e.length>0)).map((e=>{const t=e.replace("(","").trim(),[a,o]=t.split(",").map((e=>parseFloat(e.trim())));return{x:a,y:o}})),h=()=>{if(e.backgroundimage){const t=new Image;t.src=e.backgroundimage,t.onload=()=>{n.value=t}}},y=()=>{if(!l.value)return;const e=r.value.getNode().getPointerPosition();if(u.value=[...u.value,e.x,e.y],u.value.length>=8){const[e,t]=[u.value[0],u.value[1]],[a,o]=[u.value[u.value.length-2],u.value[u.value.length-1]],r=Math.hypot(a-e,o-t);r<10&&(c.value=u.value.reduce(((e,t,a)=>a%2===0?[...e,`(${t.toFixed(4)}, ${u.value[a+1].toFixed(4)})`]:e),[]).join(" "),i.value=!0)}},b=()=>{s.value&&(t("areaSelected",{id:s.value,coordinates:c.value}),x())},x=()=>{i.value=!1,s.value=null,u.value=[]},k=()=>{l.value=!l.value},A=()=>{t("uploadPlans")};return(0,o.sV)((()=>{h(),r.value&&r.value.getNode().on("click",y)})),(0,o.wB)((()=>e.backgroundimage),h),(0,o.sV)((()=>{r.value.getNode().on("mousemove",f)})),{stage:r,stageConfig:a,backgroundImg:n,parseCoordinates:m,currentArea:u,drawMode:l,showModal:i,selectedAreaId:s,coordinatesString:c,toggleDrawMode:k,openUploadPlans:A,confirmAreaSelection:b,closeModal:x,calculateAreaCenter:v,cancelDraw:p,handleMouseMove:f,mousePosition:g}}},C=a(1241);const L=(0,C.A)(w,[["render",A],["__scopeId","data-v-3ed3d8b6"]]);var $=L;const _={class:"fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50"},P={class:"bg-white p-6 rounded-lg shadow-md w-96"},E={class:"flex justify-end space-x-4"};function U(e,t,a,r,n,l){return(0,o.uX)(),(0,o.CE)("div",_,[(0,o.Lk)("div",P,[t[4]||(t[4]=(0,o.Lk)("h2",{class:"text-lg font-bold mb-4"},"Cargar Plano",-1)),(0,o.Lk)("form",{onSubmit:t[2]||(t[2]=(0,f.D$)(((...e)=>r.submitForm&&r.submitForm(...e)),["prevent"]))},[(0,o.Lk)("input",{type:"file",onChange:t[0]||(t[0]=(...e)=>r.handleFileChange&&r.handleFileChange(...e)),accept:"image/*",class:"block w-full mb-4 border border-gray-300 rounded-lg"},null,32),(0,o.Lk)("div",E,[(0,o.Lk)("button",{type:"button",onClick:t[1]||(t[1]=t=>e.$emit("close")),class:"px-4 py-2 bg-gray-400 text-white rounded-lg"}," Cancelar "),t[3]||(t[3]=(0,o.Lk)("button",{type:"submit",class:"px-4 py-2 bg-[#396895] text-white rounded-lg hover:bg-[#6999c2]"}," Subir ",-1))])],32)])])}var I={props:{layoutId:{type:String,required:!0}},emits:["close","imageUploaded"],setup(e,{emit:t}){const a=(0,d.KR)(null),o=e=>{a.value=e.target.files[0]},r=()=>{if(!a.value)return;const o=new FormData;o.append("image",a.value);const r=e.layoutId;t("imageUploaded",o,r),t("close")};return{handleFileChange:o,submitForm:r}}};const S=(0,C.A)(I,[["render",U]]);var M=S,F=a(5129),R={components:{ModalLayoutPlane:$,UploadPlanModal:M},setup(){const e=(0,d.KR)([]),t=(0,d.KR)(0),a=(0,d.KR)(null),r=(0,d.KR)(!1),n=F.A.state.token,l=async()=>{try{const t=await(0,g.bN)(n);t&&t.data&&t.data.data?e.value=t.data.data:a.value=t.data.message||"Error al cargar los layouts"}catch(t){a.value="Error al conectar con el servidor. Por favor, inténtalo de nuevo."}},i=()=>{r.value=!0},s=async(e,t)=>{try{const a=await(0,g.IO)(n,e,t);a&&await l()}catch(a){console.error("error al cargar plano")}},u=async e=>{const t={coordinates:e.coordinates};try{const a=await(0,p.F7)(n,t,e.id);a&&await l()}catch(a){console.error("error al crear area")}},c=e=>{t.value=e};(0,o.sV)(l);const f=(0,o.EW)((()=>{const a=e.value[t.value];return{...a,areas:a?a.areas:[]}}));return{layouts:e,selectedLayout:f,selectedIndex:t,showUploadModal:r,openUploadModal:i,handleImageUpload:s,selectLayout:c,selectCoordinates:u}}};const K=(0,C.A)(R,[["render",c],["__scopeId","data-v-5926112e"]]);var B=K},1161:function(e,t,a){a.d(t,{y:function(){return v}});var o=a(6768),r=a(7576),n=a(1950),l=a(2067),i=a(2876),s=a(144),u=a(4587),c=a(9094),d=a(1247),g=a(7861),p=a(4600);const f=(0,u.j)({id:String,text:String,...(0,c.cJ)((0,r.D)({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:!1}),["absolute","persistent"])},"VTooltip"),v=(0,d.RW)()({name:"VTooltip",props:f(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:a}=t;const u=(0,l.q)(e,"modelValue"),{scopeId:c}=(0,i.b)(),d=(0,g.v6)(),f=(0,o.EW)((()=>e.id||`v-tooltip-${d}`)),v=(0,s.KR)(),m=(0,o.EW)((()=>e.location.split(" ").length>1?e.location:e.location+" center")),h=(0,o.EW)((()=>"auto"===e.origin||"overlap"===e.origin||e.origin.split(" ").length>1||e.location.split(" ").length>1?e.origin:e.origin+" center")),y=(0,o.EW)((()=>e.transition?e.transition:u.value?"scale-transition":"fade-transition")),b=(0,o.EW)((()=>(0,o.v6)({"aria-describedby":f.value},e.activatorProps)));return(0,p.C)((()=>{const t=r.L.filterProps(e);return(0,o.bF)(r.L,(0,o.v6)({ref:v,class:["v-tooltip",e.class],style:e.style,id:f.value},t,{modelValue:u.value,"onUpdate:modelValue":e=>u.value=e,transition:y.value,absolute:!0,location:m.value,origin:h.value,persistent:!0,role:"tooltip",activatorProps:b.value,_disableGlobalStack:!0},c),{activator:a.activator,default:function(){for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return a.default?.(...o)??e.text}})})),(0,n.O)({},v)}})}}]);
//# sourceMappingURL=584.5025e2c1.js.map