"use strict";(self["webpackChunkfrontend_ebox_platform"]=self["webpackChunkfrontend_ebox_platform"]||[]).push([[982],{9980:function(e,t,a){a.d(t,{$x:function(){return s},F7:function(){return d},Qt:function(){return i},ZL:function(){return n},ZZ:function(){return l}});var r=a(1189);const o="https://api.bwasi.maquiadev.com/api/v1";function n(e){return r.A.get(`${o}/areas`,{headers:{Authorization:`Bearer ${e}`}})}function s(e,t){return r.A.delete(`${o}/areas/${t}`,{headers:{Authorization:`Bearer ${e}`}})}function i(e,t){return r.A.post(`${o}/areas`,t,{headers:{Authorization:`Bearer ${e}`}})}function l(e,t,a){return r.A.patch(`${o}/areas/${a}`,t,{headers:{Authorization:`Bearer ${e}`}})}function d(e,t,a){return r.A.patch(`${o}/areas/${a}`,t,{headers:{Authorization:`Bearer ${e}`}})}},3129:function(e,t,a){a.d(t,{ED:function(){return n},du:function(){return s},tH:function(){return l},y:function(){return i}});var r=a(1189);const o="https://api.bwasi.maquiadev.com/api/v1";function n(e){return r.A.get(`${o}/group-areas`,{headers:{Authorization:`Bearer ${e}`}})}function s(e,t){return r.A.delete(`${o}/group-areas/${t}`,{headers:{Authorization:`Bearer ${e}`}})}function i(e,t){return r.A.post(`${o}/group-areas`,t,{headers:{Authorization:`Bearer ${e}`}})}function l(e,t,a){return r.A.patch(`${o}/group-areas/${a}`,t,{headers:{Authorization:`Bearer ${e}`}})}},2678:function(e,t,a){a.d(t,{Go:function(){return l},dK:function(){return n},dU:function(){return i},oY:function(){return s}});var r=a(1189);const o="https://api.bwasi.maquiadev.com/api/v1";function n(e){return r.A.get(`${o}/group-mobileitems`,{headers:{Authorization:`Bearer ${e}`}})}function s(e,t){return r.A.delete(`${o}/group-mobileitems/${t}`,{headers:{Authorization:`Bearer ${e}`}})}function i(e,t){return r.A.post(`${o}/group-mobileitems`,t,{headers:{Authorization:`Bearer ${e}`}})}function l(e,t,a){return r.A.patch(`${o}/group-mobileitems/${a}`,t,{headers:{Authorization:`Bearer ${e}`}})}},15:function(e,t,a){a.d(t,{B:function(){return o}});a(4114),a(1454);function r(e){return{all:e=e||new Map,on:function(t,a){var r=e.get(t);r?r.push(a):e.set(t,[a])},off:function(t,a){var r=e.get(t);r&&(a?r.splice(r.indexOf(a)>>>0,1):e.set(t,[]))},emit:function(t,a){var r=e.get(t);r&&r.slice().map((function(e){e(a)})),(r=e.get("*"))&&r.slice().map((function(e){e(t,a)}))}}}const o=r()},1982:function(e,t,a){a.r(t),a.d(t,{default:function(){return Q}});var r=a(6768);const o={key:0,class:"fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75 z-[9999]"};function n(e,t,a,n,s,i){const l=(0,r.g2)("DateForm"),d=(0,r.g2)("DataTable");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.Lk)("div",null,[t[0]||(t[0]=(0,r.Lk)("div",{class:"flex justify-between items-center"},[(0,r.Lk)("h1",{class:"font-bold lg:text-2xl text-xl text-gray-500 mb-5"}," Reportes")],-1)),(0,r.bF)(l,{onApply:n.fetchItems,onExportExcel:e.generateExcel},null,8,["onApply","onExportExcel"]),(0,r.bF)(d,{items:n.items},null,8,["items"])]),n.isLoading?((0,r.uX)(),(0,r.CE)("div",o,t[1]||(t[1]=[(0,r.Lk)("div",{class:"flex flex-col items-center space-y-4"},[(0,r.Lk)("div",{class:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-white"}),(0,r.Lk)("p",{class:"text-white text-lg font-semibold"},"Cargando, por favor espera...")],-1)]))):(0,r.Q3)("",!0)],64)}var s=a(144),i=a(1189);const l="https://api.bwasi.maquiadev.com/api/v1";function d(e,t){return i.A.post(`${l}/reports/monitoring`,t,{headers:{Authorization:`Bearer ${e}`}})}var c=a(5129),u=a(2729),m=a(4260),p=a(4750);const f={class:"mb-5 pb-5"};function g(e,t,a,o,n,s){return(0,r.uX)(),(0,r.CE)("div",f,[(0,r.bF)(p.W,{modelValue:o.search,"onUpdate:modelValue":t[0]||(t[0]=e=>o.search=e),label:"Buscar","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"mb-5 PT-3",density:"compact"},null,8,["modelValue"]),(0,r.bF)(u.J,{flat:""},{default:(0,r.k6)((()=>[(0,r.bF)(m.Py,{headers:o.headers,items:o.filteredItems,search:o.search,density:"compact",class:"ma-2"},null,8,["headers","items","search"])])),_:1})])}a(8992),a(4520),a(3949),a(1454),a(7550);var h=a(15),b=a(3230),v={name:"DataTable",props:{items:{type:Array,required:!0}},setup(e){const t=(0,s.KR)(""),a=e=>{if(!e)return"";const t=new Date(e);return t.setHours(t.getHours()+5),t.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h23"})},o=e=>{if(!e)return"";const t=new Date(e);return t.setHours(t.getHours()+6),t.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})},n=(0,s.KR)([{key:"id",title:"#"},{key:"createdAt",title:"Fecha"},{key:"identifier",title:"Identificador"},{key:"name",title:"Nombre"},{key:"entryTime",title:"Hora de ingreso"},{key:"exitTime",title:"Hora de salida"},{key:"area.name",title:"Área"},{key:"difference",title:"Tiempo de permanencia"}]),i=(0,r.EW)((()=>e.items.map(((e,t)=>({id:t+1,itemMobileMac:e.itemMobileMac,name:e.name,entryTime:a(e.entryTime),exitTime:a(e.exitTime),"area.name":e.area?.name||"N/A",identifier:e.identifier,difference:e.difference,createdAt:o(e.createdAt)}))))),l=(0,r.EW)((()=>{if(!t.value)return i.value;const e=t.value.toLowerCase();return i.value.filter((t=>Object.values(t).some((t=>String(t).toLowerCase().includes(e)))))})),d=()=>{const e=l.value.map((e=>{const t={};return n.value.forEach((a=>{t[a.title]=e[a.key]})),t})),t=b.Wp.json_to_sheet(e),a=b.Wp.book_new();b.Wp.book_append_sheet(a,t,"Datos"),b._h(a,"reporte.xlsx")},c=()=>{console.log("Generando archivo Excel con los datos de la tabla..."),d()};return(0,r.sV)((()=>{h.B.on("export-requested",c)})),(0,r.hi)((()=>{h.B.off("export-requested",c)})),{search:t,filteredItems:l,headers:n}}},x=a(1241);const k=(0,x.A)(v,[["render",g],["__scopeId","data-v-45f09a46"]]);var y=k,w=a(5130),L=a(4232);const A={class:"flex items-center space-x-2 p-2 bg-gray-50 shadow rounded-lg mb-3"},I={class:"w-1/3"},E={class:"w-1/3"},T=["for"],$={class:"relative"},D=["onClick"],_={key:0,class:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-60"},C={class:"p-3"},F={class:"relative"},B=["onUpdate:modelValue"],S={class:"h-48 px-3 pb-3 overflow-y-auto text-sm text-gray-700 dark:text-gray-600"},z={class:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center"},H=["checked","onChange"],K=["value","onUpdate:modelValue","disabled"],U={class:"flex space-x-2 w-1/6 mt-6"};function V(e,t,a,o,n,s){return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.Lk)("div",A,[(0,r.Lk)("div",I,[t[4]||(t[4]=(0,r.Lk)("label",{for:"start-date",class:"block text-sm font-medium text-gray-700"},"Desde",-1)),(0,r.bo)((0,r.Lk)("input",{id:"start-date",type:"datetime-local","onUpdate:modelValue":t[0]||(t[0]=e=>o.startDate=e),class:"mt-2 block w-full h-10 border-gray-300 rounded-lg bg-[#bfd3e6] p-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"},null,512),[[w.Jo,o.startDate]])]),(0,r.Lk)("div",E,[t[5]||(t[5]=(0,r.Lk)("label",{for:"end-date",class:"block text-sm font-medium text-gray-700"},"Hasta",-1)),(0,r.bo)((0,r.Lk)("input",{id:"end-date",type:"datetime-local","onUpdate:modelValue":t[1]||(t[1]=e=>o.endDate=e),class:"mt-2 block w-full h-10 border-gray-300 rounded-lg bg-[#bfd3e6] p-1 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"},null,512),[[w.Jo,o.endDate]])]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.dropdowns,((e,a)=>((0,r.uX)(),(0,r.CE)("div",{class:"w-1/3 relative",key:a},[(0,r.Lk)("label",{for:"select-option-"+a,class:"block text-sm font-medium text-gray-700"},(0,L.v_)(e.label),9,T),(0,r.Lk)("div",$,[(0,r.Lk)("button",{onClick:e=>o.toggleDropdown(a),class:"mt-2 block w-full h-10 px-4 bg-[#bfd3e6] border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm text-left truncate"},(0,L.v_)(o.getSelectedText(a)),9,D),e.open?((0,r.uX)(),(0,r.CE)("div",_,[(0,r.Lk)("div",C,[t[7]||(t[7]=(0,r.Lk)("label",{for:"input-group-search",class:"sr-only"},"Search",-1)),(0,r.Lk)("div",F,[t[6]||(t[6]=(0,r.Lk)("div",{class:"absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"},[(0,r.Lk)("svg",{class:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20"},[(0,r.Lk)("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"})])],-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"input-group-search","onUpdate:modelValue":t=>e.searchTerm=t,class:"block w-full p-2 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-#497fae-500 focus:border-#497fae-500 bg-white-600 border-gray-500 dark:placeholder-gray-400 dark:text-gray dark:focus:ring-#497fae-500 dark:focus:border-#497fae-500",placeholder:"Buscar"},null,8,B),[[w.Jo,e.searchTerm]])])]),(0,r.Lk)("ul",S,[(0,r.Lk)("li",z,[(0,r.Lk)("input",{type:"checkbox",checked:e.selectedIds.includes("ALL"),onChange:e=>o.toggleSelectAll(a),class:"mr-2"},null,40,H),t[8]||(t[8]=(0,r.eW)(" Todos "))]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.filteredData(a),(t=>((0,r.uX)(),(0,r.CE)("li",{key:t._id,class:"px-4 py-2 flex items-center hover:bg-gray-100 cursor-pointer"},[(0,r.bo)((0,r.Lk)("input",{type:"checkbox",value:t._id,"onUpdate:modelValue":t=>e.selectedIds=t,disabled:e.selectedIds.includes("ALL"),class:"mr-2"},null,8,K),[[w.lH,e.selectedIds]]),(0,r.eW)(" "+(0,L.v_)(t.name),1)])))),128))])])):(0,r.Q3)("",!0)])])))),128)),(0,r.Lk)("div",U,[(0,r.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>o.validateAndEmitFilter&&o.validateAndEmitFilter(...e)),class:"w-1/2 h-10 bg-[#396895] text-white font-semibold rounded-lg shadow-md hover:bg-[#396895] focus:outline-none focus:ring-2 focus:ring-[#497fae] focus:ring-opacity-75 mdi mdi-magnify text-xl"}),(0,r.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>o.emitExportEvent&&o.emitExportEvent(...e)),class:"w-1/2 h-10 bg-[#099cb4] text-white font-semibold rounded-lg shadow-md hover:bg-#099cb4-600 focus:outline-none focus:ring-2 focus:ring-#099cb4-400 focus:ring-opacity-75 mdi mdi-microsoft-excel text-xl"})])])])}var q=a(4874),X=a.n(q),R=a(1385),W=a(2678),j=a(9980),O=a(3129),M={setup(e,{emit:t}){const a=(0,s.KR)(""),o=(0,s.KR)(""),n=(0,s.KR)([{label:"Etiquetas",fetchData:R.pu,data:[],selectedIds:[],open:!1,searchTerm:""},{label:"G. Etiquetas",fetchData:W.dK,data:[],selectedIds:[],open:!1,searchTerm:""},{label:"Área",fetchData:j.ZL,data:[],selectedIds:[],open:!1,searchTerm:""},{label:"G. Áreas",fetchData:O.ED,data:[],selectedIds:[],open:!1,searchTerm:""}]),i=c.A.state.token,l=e=>{const t=n.value[e];if(!t.selectedIds.length)return"Seleccionar";if(t.selectedIds.includes("ALL"))return"Todos seleccionados";const a=t.data.filter((e=>t.selectedIds.includes(e._id))).map((e=>e.name));return a.length<=2?a.join(", "):`${a.slice(0,2).join(", ")} y ${a.length-2} más`},d=()=>{const e=new Date,t=-300,a=new Date(e.getTime()+60*t*1e3),r=new Date(a.setUTCHours(0,0,0,0)),o=r.toISOString().slice(0,19),n=new Date(a.setUTCHours(23,59,0,0)),s=n.toISOString().slice(0,19);return{dateFrom:o,dateTo:s}};(0,r.sV)((()=>{const{dateFrom:e,dateTo:t}=d();a.value=e,o.value=t}));const u=async e=>{const t=n.value[e];if(!t.data.length)try{const e=await t.fetchData(i);t.data=e.data.data||[]}catch(a){console.error("Error fetching data:",a)}t.open=!t.open},m=e=>{const t=n.value[e].searchTerm.toLowerCase();return n.value[e].data.filter((e=>e.name.toLowerCase().includes(t)))},p=e=>{const t=n.value[e];t.selectedIds.includes("ALL")?t.selectedIds=[]:t.selectedIds=["ALL"]},f=()=>{if(!a.value||!o.value)return void X().fire({icon:"error",title:"Fechas incompletas",text:"Por favor, selecciona ambas fechas."});const e={dateFrom:a.value,dateTo:o.value,mobile_items:n.value[0].selectedIds.length?n.value[0].selectedIds:[],group_mobile_items:n.value[1].selectedIds.length?n.value[1].selectedIds:[],areas:n.value[2].selectedIds.length?n.value[2].selectedIds:[],group_areas:n.value[3].selectedIds.length?n.value[3].selectedIds:[]};console.log("Emitting filter data:",e),t("apply",e),n.value.forEach((e=>{e.open=!1}))},g=()=>{const e={dateFrom:a.value,dateTo:o.value,mobile_items:n.value[0].selectedIds.length?n.value[0].selectedIds:[""],group_mobile_items:n.value[1].selectedIds.length?n.value[1].selectedIds:[""],areas:n.value[2].selectedIds.length?n.value[2].selectedIds:[""],group_areas:n.value[3].selectedIds.length?n.value[3].selectedIds:[""]};console.log("Emitting export data:",e),h.B.emit("export-requested",e)};return{startDate:a,endDate:o,dropdowns:n,toggleDropdown:u,filteredData:m,toggleSelectAll:p,validateAndEmitFilter:f,emitExportEvent:g,getSelectedText:l}}};const Z=(0,x.A)(M,[["render",V],["__scopeId","data-v-b5cce4b8"]]);var G=Z,J={components:{DataTable:y,DateForm:G},setup(){const e=(0,s.KR)([]),t=(0,s.KR)(!1),a=()=>{t.value=!0},o=()=>{t.value=!1},n=()=>{const e=new Date,t=-300,a=new Date(e.getTime()+60*t*1e3),r=new Date(a.setUTCHours(0,0,0,0)),o=r.toISOString().slice(0,19).replace("T"," "),n=new Date(a.setUTCHours(23,59,0,0)),s=n.toISOString().slice(0,19).replace("T"," ");return{dateFrom:o,dateTo:s}},i=async()=>{try{const{dateFrom:e,dateTo:t}=n(),a={dateFrom:e,dateTo:t,mobile_items:["ALL"],group_mobile_items:["ALL"],areas:["ALL"],group_areas:["ALL"]};await l(a)}catch(e){console.error("Error al enviar las fechas iniciales:",e)}},l=async t=>{a();try{const a=c.A.state.token,r=await d(a,t);e.value=r.data.data,o()}catch(r){o();const e=r.response?.data?.message||r.response?.data||"Error al obtener los reportes.";X().fire({title:"Error",text:e,icon:"error",confirmButtonText:"Aceptar"})}};return(0,r.sV)(i),{items:e,fetchItems:l,openLoading:a,closeLoading:o,isLoading:t,insertDate:i}}};const P=(0,x.A)(J,[["render",n]]);var Q=P}}]);
//# sourceMappingURL=982.6ab03040.js.map