"use strict";(self["webpackChunkfrontend_ebox_platform"]=self["webpackChunkfrontend_ebox_platform"]||[]).push([[982],{9980:function(e,t,r){r.d(t,{$x:function(){return s},F7:function(){return d},Qt:function(){return l},ZL:function(){return n},ZZ:function(){return i}});var a=r(1189);const o={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_BASE_URL;function n(e){return a.A.get(`${o}/areas`,{headers:{Authorization:`Bearer ${e}`}})}function s(e,t){return a.A.delete(`${o}/areas/${t}`,{headers:{Authorization:`Bearer ${e}`}})}function l(e,t){return a.A.post(`${o}/areas`,t,{headers:{Authorization:`Bearer ${e}`}})}function i(e,t,r){return a.A.patch(`${o}/areas/${r}`,t,{headers:{Authorization:`Bearer ${e}`}})}function d(e,t,r){return a.A.patch(`${o}/areas/${r}`,t,{headers:{Authorization:`Bearer ${e}`}})}},3129:function(e,t,r){r.d(t,{ED:function(){return n},du:function(){return s},tH:function(){return i},y:function(){return l}});var a=r(1189);const o={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_BASE_URL;function n(e){return a.A.get(`${o}/group-areas`,{headers:{Authorization:`Bearer ${e}`}})}function s(e,t){return a.A.delete(`${o}/group-areas/${t}`,{headers:{Authorization:`Bearer ${e}`}})}function l(e,t){return a.A.post(`${o}/group-areas`,t,{headers:{Authorization:`Bearer ${e}`}})}function i(e,t,r){return a.A.patch(`${o}/group-areas/${r}`,t,{headers:{Authorization:`Bearer ${e}`}})}},2678:function(e,t,r){r.d(t,{Go:function(){return i},dK:function(){return n},dU:function(){return l},oY:function(){return s}});var a=r(1189);const o={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_BASE_URL;function n(e){return a.A.get(`${o}/group-mobileitems`,{headers:{Authorization:`Bearer ${e}`}})}function s(e,t){return a.A.delete(`${o}/group-mobileitems/${t}`,{headers:{Authorization:`Bearer ${e}`}})}function l(e,t){return a.A.post(`${o}/group-mobileitems`,t,{headers:{Authorization:`Bearer ${e}`}})}function i(e,t,r){return a.A.patch(`${o}/group-mobileitems/${r}`,t,{headers:{Authorization:`Bearer ${e}`}})}},15:function(e,t,r){r.d(t,{B:function(){return o}});r(4114),r(1454);function a(e){return{all:e=e||new Map,on:function(t,r){var a=e.get(t);a?a.push(r):e.set(t,[r])},off:function(t,r){var a=e.get(t);a&&(r?a.splice(a.indexOf(r)>>>0,1):e.set(t,[]))},emit:function(t,r){var a=e.get(t);a&&a.slice().map((function(e){e(r)})),(a=e.get("*"))&&a.slice().map((function(e){e(t,r)}))}}}const o=a()},1982:function(e,t,r){r.r(t),r.d(t,{default:function(){return J}});var a=r(6768);const o={key:0,class:"fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75 z-[9999]"};function n(e,t,r,n,s,l){const i=(0,a.g2)("DateForm"),d=(0,a.g2)("DataTable");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.Lk)("div",null,[t[0]||(t[0]=(0,a.Lk)("div",{class:"flex justify-between items-center"},[(0,a.Lk)("h1",{class:"font-bold lg:text-2xl text-xl text-gray-500 mb-5"}," Reportes")],-1)),(0,a.bF)(i,{onApply:n.fetchItems,onExportExcel:e.generateExcel},null,8,["onApply","onExportExcel"]),(0,a.bF)(d,{items:n.items},null,8,["items"])]),n.isLoading?((0,a.uX)(),(0,a.CE)("div",o,t[1]||(t[1]=[(0,a.Lk)("div",{class:"flex flex-col items-center space-y-4"},[(0,a.Lk)("div",{class:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-white"}),(0,a.Lk)("p",{class:"text-white text-lg font-semibold"},"Cargando, por favor espera...")],-1)]))):(0,a.Q3)("",!0)],64)}var s=r(144),l=r(1189);const i={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_BASE_URL;function d(e,t){return l.A.post(`${i}/reports/monitoring`,t,{headers:{Authorization:`Bearer ${e}`}})}var c=r(5129),u=r(2729),m=r(4260),f=r(4750);const p={class:"mb-5 pb-5"};function g(e,t,r,o,n,s){return(0,a.uX)(),(0,a.CE)("div",p,[(0,a.bF)(f.W,{modelValue:o.search,"onUpdate:modelValue":t[0]||(t[0]=e=>o.search=e),label:"Buscar","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":"",class:"mb-5 PT-3",density:"compact"},null,8,["modelValue"]),(0,a.bF)(u.J,{flat:""},{default:(0,a.k6)((()=>[(0,a.bF)(m.Py,{headers:o.headers,items:o.filteredItems,search:o.search,density:"compact",class:"ma-2"},null,8,["headers","items","search"])])),_:1})])}r(8992),r(4520),r(3949),r(1454),r(7550);var h=r(15),b=r(3230),v={name:"DataTable",props:{items:{type:Array,required:!0}},setup(e){const t=(0,s.KR)(""),r=e=>{if(!e)return"";const t=new Date(e);return t.setHours(t.getHours()+5),t.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h23"})},o=e=>{if(!e)return"";const t=new Date(e);return t.setHours(t.getHours()+6),t.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})},n=(0,s.KR)([{key:"id",title:"#"},{key:"createdAt",title:"Fecha"},{key:"identifier",title:"Identificador"},{key:"name",title:"Nombre"},{key:"entryTime",title:"Hora de ingreso"},{key:"exitTime",title:"Hora de salida"},{key:"area.name",title:"Área"},{key:"difference",title:"Tiempo de permanencia"}]),l=(0,a.EW)((()=>e.items.map(((e,t)=>({id:t+1,itemMobileMac:e.itemMobileMac,name:e.name,entryTime:r(e.entryTime),exitTime:r(e.exitTime),"area.name":e.area?.name||"N/A",identifier:e.identifier,difference:e.difference,createdAt:o(e.createdAt)}))))),i=(0,a.EW)((()=>{if(!t.value)return l.value;const e=t.value.toLowerCase();return l.value.filter((t=>Object.values(t).some((t=>String(t).toLowerCase().includes(e)))))})),d=()=>{const e=i.value.map((e=>{const t={};return n.value.forEach((r=>{t[r.title]=e[r.key]})),t})),t=b.Wp.json_to_sheet(e),r=b.Wp.book_new();b.Wp.book_append_sheet(r,t,"Datos"),b._h(r,"reporte.xlsx")},c=()=>{console.log("Generando archivo Excel con los datos de la tabla..."),d()};return(0,a.sV)((()=>{h.B.on("export-requested",c)})),(0,a.hi)((()=>{h.B.off("export-requested",c)})),{search:t,filteredItems:i,headers:n}}},x=r(1241);const k=(0,x.A)(v,[["render",g],["__scopeId","data-v-45f09a46"]]);var y=k,A=r(5130),L=r(4232);const E={class:"flex items-center space-x-2 p-2 bg-gray-50 shadow rounded-lg mb-3"},w={class:"w-1/3"},_={class:"w-1/3"},I=["for"],D={class:"relative"},T=["onClick"],$={key:0,class:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-60"},B={class:"p-3"},C={class:"relative"},S=["onUpdate:modelValue"],U={class:"h-48 px-3 pb-3 overflow-y-auto text-sm text-gray-700 dark:text-gray-600"},F={class:"px-4 py-2 hover:bg-gray-100 cursor-pointer flex items-center"},V=["checked","onChange"],z=["value","onUpdate:modelValue","disabled"],R={class:"flex space-x-2 w-1/6 mt-6"};function H(e,t,r,o,n,s){return(0,a.uX)(),(0,a.CE)("div",null,[(0,a.Lk)("div",E,[(0,a.Lk)("div",w,[t[4]||(t[4]=(0,a.Lk)("label",{for:"start-date",class:"block text-sm font-medium text-gray-700"},"Desde",-1)),(0,a.bo)((0,a.Lk)("input",{id:"start-date",type:"datetime-local","onUpdate:modelValue":t[0]||(t[0]=e=>o.startDate=e),class:"mt-2 block w-full h-10 border-gray-300 rounded-lg bg-[#bfd3e6] p-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"},null,512),[[A.Jo,o.startDate]])]),(0,a.Lk)("div",_,[t[5]||(t[5]=(0,a.Lk)("label",{for:"end-date",class:"block text-sm font-medium text-gray-700"},"Hasta",-1)),(0,a.bo)((0,a.Lk)("input",{id:"end-date",type:"datetime-local","onUpdate:modelValue":t[1]||(t[1]=e=>o.endDate=e),class:"mt-2 block w-full h-10 border-gray-300 rounded-lg bg-[#bfd3e6] p-1 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm"},null,512),[[A.Jo,o.endDate]])]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.dropdowns,((e,r)=>((0,a.uX)(),(0,a.CE)("div",{class:"w-1/3 relative",key:r},[(0,a.Lk)("label",{for:"select-option-"+r,class:"block text-sm font-medium text-gray-700"},(0,L.v_)(e.label),9,I),(0,a.Lk)("div",D,[(0,a.Lk)("button",{onClick:e=>o.toggleDropdown(r),class:"mt-2 block w-full h-10 px-4 bg-[#bfd3e6] border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm text-left truncate"},(0,L.v_)(o.getSelectedText(r)),9,T),e.open?((0,a.uX)(),(0,a.CE)("div",$,[(0,a.Lk)("div",B,[t[7]||(t[7]=(0,a.Lk)("label",{for:"input-group-search",class:"sr-only"},"Search",-1)),(0,a.Lk)("div",C,[t[6]||(t[6]=(0,a.Lk)("div",{class:"absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"},[(0,a.Lk)("svg",{class:"w-4 h-4 text-gray-500 dark:text-gray-400","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 20 20"},[(0,a.Lk)("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"})])],-1)),(0,a.bo)((0,a.Lk)("input",{type:"text",id:"input-group-search","onUpdate:modelValue":t=>e.searchTerm=t,class:"block w-full p-2 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-#497fae-500 focus:border-#497fae-500 bg-white-600 border-gray-500 dark:placeholder-gray-400 dark:text-gray dark:focus:ring-#497fae-500 dark:focus:border-#497fae-500",placeholder:"Buscar"},null,8,S),[[A.Jo,e.searchTerm]])])]),(0,a.Lk)("ul",U,[(0,a.Lk)("li",F,[(0,a.Lk)("input",{type:"checkbox",checked:e.selectedIds.includes("ALL"),onChange:e=>o.toggleSelectAll(r),class:"mr-2"},null,40,V),t[8]||(t[8]=(0,a.eW)(" Todos "))]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(o.filteredData(r),(t=>((0,a.uX)(),(0,a.CE)("li",{key:t._id,class:"px-4 py-2 flex items-center hover:bg-gray-100 cursor-pointer"},[(0,a.bo)((0,a.Lk)("input",{type:"checkbox",value:t._id,"onUpdate:modelValue":t=>e.selectedIds=t,disabled:e.selectedIds.includes("ALL"),class:"mr-2"},null,8,z),[[A.lH,e.selectedIds]]),(0,a.eW)(" "+(0,L.v_)(t.name),1)])))),128))])])):(0,a.Q3)("",!0)])])))),128)),(0,a.Lk)("div",R,[(0,a.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>o.validateAndEmitFilter&&o.validateAndEmitFilter(...e)),class:"w-1/2 h-10 bg-[#396895] text-white font-semibold rounded-lg shadow-md hover:bg-[#396895] focus:outline-none focus:ring-2 focus:ring-[#497fae] focus:ring-opacity-75 mdi mdi-magnify text-xl"}),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>o.emitExportEvent&&o.emitExportEvent(...e)),class:"w-1/2 h-10 bg-[#099cb4] text-white font-semibold rounded-lg shadow-md hover:bg-#099cb4-600 focus:outline-none focus:ring-2 focus:ring-#099cb4-400 focus:ring-opacity-75 mdi mdi-microsoft-excel text-xl"})])])])}var K=r(4874),P=r.n(K),N=r(1385),O=r(2678),X=r(9980),W=r(3129),j={setup(e,{emit:t}){const r=(0,s.KR)(""),o=(0,s.KR)(""),n=(0,s.KR)([{label:"Etiquetas",fetchData:N.pu,data:[],selectedIds:[],open:!1,searchTerm:""},{label:"G. Etiquetas",fetchData:O.dK,data:[],selectedIds:[],open:!1,searchTerm:""},{label:"Área",fetchData:X.ZL,data:[],selectedIds:[],open:!1,searchTerm:""},{label:"G. Áreas",fetchData:W.ED,data:[],selectedIds:[],open:!1,searchTerm:""}]),l=c.A.state.token,i=e=>{const t=n.value[e];if(!t.selectedIds.length)return"Seleccionar";if(t.selectedIds.includes("ALL"))return"Todos seleccionados";const r=t.data.filter((e=>t.selectedIds.includes(e._id))).map((e=>e.name));return r.length<=2?r.join(", "):`${r.slice(0,2).join(", ")} y ${r.length-2} más`},d=()=>{const e=new Date,t=-300,r=new Date(e.getTime()+60*t*1e3),a=new Date(r.setUTCHours(0,0,0,0)),o=a.toISOString().slice(0,19),n=new Date(r.setUTCHours(23,59,0,0)),s=n.toISOString().slice(0,19);return{dateFrom:o,dateTo:s}};(0,a.sV)((()=>{const{dateFrom:e,dateTo:t}=d();r.value=e,o.value=t}));const u=async e=>{const t=n.value[e];if(!t.data.length)try{const e=await t.fetchData(l);t.data=e.data.data||[]}catch(r){console.error("Error fetching data:",r)}t.open=!t.open},m=e=>{const t=n.value[e].searchTerm.toLowerCase();return n.value[e].data.filter((e=>e.name.toLowerCase().includes(t)))},f=e=>{const t=n.value[e];t.selectedIds.includes("ALL")?t.selectedIds=[]:t.selectedIds=["ALL"]},p=()=>{if(!r.value||!o.value)return void P().fire({icon:"error",title:"Fechas incompletas",text:"Por favor, selecciona ambas fechas."});const e={dateFrom:r.value,dateTo:o.value,mobile_items:n.value[0].selectedIds.length?n.value[0].selectedIds:[],group_mobile_items:n.value[1].selectedIds.length?n.value[1].selectedIds:[],areas:n.value[2].selectedIds.length?n.value[2].selectedIds:[],group_areas:n.value[3].selectedIds.length?n.value[3].selectedIds:[]};console.log("Emitting filter data:",e),t("apply",e),n.value.forEach((e=>{e.open=!1}))},g=()=>{const e={dateFrom:r.value,dateTo:o.value,mobile_items:n.value[0].selectedIds.length?n.value[0].selectedIds:[""],group_mobile_items:n.value[1].selectedIds.length?n.value[1].selectedIds:[""],areas:n.value[2].selectedIds.length?n.value[2].selectedIds:[""],group_areas:n.value[3].selectedIds.length?n.value[3].selectedIds:[""]};console.log("Emitting export data:",e),h.B.emit("export-requested",e)};return{startDate:r,endDate:o,dropdowns:n,toggleDropdown:u,filteredData:m,toggleSelectAll:f,validateAndEmitFilter:p,emitExportEvent:g,getSelectedText:i}}};const q=(0,x.A)(j,[["render",H],["__scopeId","data-v-b5cce4b8"]]);var M=q,Z={components:{DataTable:y,DateForm:M},setup(){const e=(0,s.KR)([]),t=(0,s.KR)(!1),r=()=>{t.value=!0},o=()=>{t.value=!1},n=()=>{const e=new Date,t=-300,r=new Date(e.getTime()+60*t*1e3),a=new Date(r.setUTCHours(0,0,0,0)),o=a.toISOString().slice(0,19).replace("T"," "),n=new Date(r.setUTCHours(23,59,0,0)),s=n.toISOString().slice(0,19).replace("T"," ");return{dateFrom:o,dateTo:s}},l=async()=>{try{const{dateFrom:e,dateTo:t}=n(),r={dateFrom:e,dateTo:t,mobile_items:["ALL"],group_mobile_items:["ALL"],areas:["ALL"],group_areas:["ALL"]};await i(r)}catch(e){console.error("Error al enviar las fechas iniciales:",e)}},i=async t=>{r();try{const r=c.A.state.token,a=await d(r,t);e.value=a.data.data,o()}catch(a){o();const e=a.response?.data?.message||a.response?.data||"Error al obtener los reportes.";P().fire({title:"Error",text:e,icon:"error",confirmButtonText:"Aceptar"})}};return(0,a.sV)(l),{items:e,fetchItems:i,openLoading:r,closeLoading:o,isLoading:t,insertDate:l}}};const G=(0,x.A)(Z,[["render",n]]);var J=G}}]);
//# sourceMappingURL=982.6ebbdb7f.js.map